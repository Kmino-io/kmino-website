---
import { getCollection, render } from "astro:content";
import { Image } from "astro:assets";
import BlogLayout from "../../layouts/BlogLayout.astro";
import { getEntry } from "astro:content";
import { Icon } from "astro-icon/components";
import { format } from "date-fns";
import ShareButtons from "~/components/ShareButtons.astro";
import PostTags from "~/components/PostTags.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog");

  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

const authorSlug = post.data.author;
const author = await getEntry("authors", authorSlug);
---

<BlogLayout frontmatter={post.data}>
  <Image
    src={post.data.image.url}
    alt={post.data.image.alt}
    height={300}
    width={900}
    layout="full-width"
    class="mb-11 max-h-[300px] w-full object-cover"
  />

  <div
    class="container block max-w-[1440px] justify-center gap-[100px] px-4 md:flex md:px-[100px]"
  >
    <div class="sticky top-0 hidden h-fit justify-end md:flex">
      <ShareButtons post={post.data} className="sticky top-0" />
    </div>

    <div
      class="prose prose-neutral prose-headings:font-alt prose-h1:text-[31px] relative"
    >
      <div class="not-prose mb-8 flex items-center justify-between">
        <a
          class="font-alt flex items-center gap-2 text-sm no-underline"
          href="/blog"
        >
          <Icon name="ri:arrow-left-line" size={18} />
          All articles
        </a>

        <p class="font-alt text-[#7A7A7A]">
          Posted on {format(post.data.pubDate, "MMMM dd, yyyy")}
        </p>
      </div>

      <Content />

      <PostTags tags={post.data.tags} className="mt-[100px] lg:hidden" />

      {
        author && (
          <div class="not-prose mt-[100px]">
            <h2 class="font-alt mb-6 text-[25px]">About the author</h2>
            <aside class="bg-primary flex w-full gap-10 rounded-sm p-6 text-white md:min-w-[504px] lg:w-fit">
              <Image
                src={author.data.image.url}
                alt={author.data.image.alt}
                width={88}
                height={88}
                loading="lazy"
                class="object-cover"
              />

              <div class="flex flex-col">
                <p class="font-alt text-[23px] leading-[27px]">
                  {author.data.name}
                </p>

                <p class="text-sm leading-[18px]">
                  {author.data.jobDescription}
                </p>

                <div class="mt-3.5 flex gap-5">
                  {author.data.socials.map((social) => (
                    <a
                      href={social.url}
                      target="_blank"
                      class="text-sm text-white/80 hover:text-white"
                      aria-label={social.title}
                      title={social.title}
                    >
                      <Icon name={social.icon} size={28} class="text-white" />
                    </a>
                  ))}
                </div>
              </div>
            </aside>
          </div>
        )
      }

      <ShareButtons post={post.data} className="mx-auto mt-6 md:hidden" />
    </div>

    <div class="sticky top-0 hidden h-fit w-fit lg:block">
      <PostTags tags={post.data.tags} />
    </div>
  </div>
</BlogLayout>

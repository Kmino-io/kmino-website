---
import { getCollection, render } from "astro:content";
import { Image } from "astro:assets";
import BlogLayout from "../../layouts/BlogLayout.astro";
import { getEntry } from "astro:content";
import { Icon } from "astro-icon/components";

export async function getStaticPaths() {
  const posts = await getCollection("blog");

  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

const authorSlug = post.data.author;
const author = await getEntry("authors", authorSlug);
---

<BlogLayout frontmatter={post.data}>
  <Image
    src={post.data.image.url}
    alt={post.data.image.alt}
    height={300}
    width={900}
    layout="full-width"
    class="mb-8 max-h-[300px] w-full object-cover"
  />

  <div class="prose mx-auto">
    <Content />

    {
      author && (
        <aside class="not-prose bg-primary flex w-fit min-w-[504px] gap-10 rounded-sm p-6 text-white">
          <Image
            src={author.data.image.url}
            alt={author.data.image.alt}
            width={88}
            height={88}
            loading="lazy"
          />

          <div class="flex flex-col">
            <p class="font-alt text-[23px] leading-[27px]">
              {author.data.name}
            </p>

            <p class="text-sm leading-[18px]">{author.data.jobDescription}</p>

            <div class="mt-3.5 flex gap-5">
              {author.data.socials.map((social) => (
                <a
                  href={social.url}
                  target="_blank"
                  class="text-sm text-white/80 hover:text-white"
                  aria-label={social.title}
                  title={social.title}
                >
                  <Icon name={social.icon} size={28} class="text-white" />
                </a>
              ))}
            </div>
          </div>
        </aside>
      )
    }
  </div>
</BlogLayout>
